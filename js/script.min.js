window.onload=function(){function e(){for(var e=0;e<d;e++){var r=randomRange(-l.emitSize,l.emitSize),i=randomRange(-l.emitSize,l.emitSize),o=randomRange(-l.emitSize,l.emitSize);r+=l.emitPosX,i+=l.emitPosY,o+=l.emitPosZ,s.vertices.push(new THREE.Vector3(r,i,o)),s.colors.push(new THREE.Color(Math.random(),Math.random(),Math.random()));var t=randomRange(l.minSpeed,l.maxSpeed),a=randomRange(-1,1),c=randomRange(-1,1),y=randomRange(-1,1);m.push({vitesse:t,direction:{x:a,y:c,z:y},acceleration:{x:0,y:0,z:0},speedLimit:1})}var v=new THREE.Points(s,g);n.add(v)}function r(){y++;for(var e=0;e<d;e++)if(y<=10){var r=m[e].vitesse*m[e].direction.x,i=m[e].vitesse*m[e].direction.y,o=m[e].vitesse*m[e].direction.z;m[e].acceleration.x+=r,m[e].acceleration.y+=i,m[e].acceleration.z+=o}}function i(){var e=v.size,r=e*e*(e*e);h++;for(var i=981,o=0;o<d;o++){var t=n.children[0].geometry.vertices[o].x,a=n.children[0].geometry.vertices[o].y,c=n.children[0].geometry.vertices[o].z,l=t*t+a*a+c*c,s=l/r;l<e?(n.children[0].geometry.vertices[o].x=0,n.children[0].geometry.vertices[o].y=0,n.children[0].geometry.vertices[o].z=0,n.children[0].geometry.colors[o].r=0,n.children[0].geometry.colors[o].g=0,n.children[0].geometry.colors[o].b=0):l>r?(n.children[0].geometry.vertices[o].x+=m[o].acceleration.x,n.children[0].geometry.vertices[o].y+=m[o].acceleration.y,n.children[0].geometry.vertices[o].z+=m[o].acceleration.z,n.children[0].geometry.colors[o].r=0,n.children[0].geometry.colors[o].g=0,n.children[0].geometry.colors[o].b=0):l<=r&&(n.children[0].geometry.colors[o].r=1-s,n.children[0].geometry.colors[o].g=1-s,n.children[0].geometry.colors[o].b=1-s,m[o].acceleration.x-=t*(1-s)/i,m[o].acceleration.y-=a*(1-s)/i,m[o].acceleration.z-=c*(1-s)/i,n.children[0].geometry.vertices[o].x+=m[o].acceleration.x,n.children[0].geometry.vertices[o].y+=m[o].acceleration.y,n.children[0].geometry.vertices[o].z+=m[o].acceleration.z)}}function o(){requestAnimationFrame(o),c.update(),a.render(n,t),n.children[0].geometry.verticesNeedUpdate=!0,n.children[0].geometry.colorsNeedUpdate=!0,r(),i()}var n=new THREE.Scene,t=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),a=new THREE.WebGLRenderer;a.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(a.domElement),n.fog=new THREE.FogExp2(0,.001);var c=new THREE.OrbitControls(t,a.domElement);c.enableDamping=!0,c.dampingFactor=.25,c.enableZoom=!0;var d=1e5,m=[],l={globalArea:100,minSpeed:0,maxSpeed:.1,gravityX:0,gravityY:0,gravityZ:0,emitSize:100,emitPosX:0,emitPosY:0,emitPosZ:0},s=new THREE.Geometry,g=new THREE.PointsMaterial({vertexColors:THREE.VertexColors,blending:THREE.NormalBlending,transparent:!0,sizeAttenuation:!1,size:2}),y=0,v={_X:0,_Y:0,_Z:0,size:10};noise.seed(Math.random()),t.position.z=200;var h=0;e(),o()};